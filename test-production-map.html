<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>üîç Production Deployment Test</h1>
    
    <div id="status" class="status loading">
        –ì–æ—Ç–æ–≤ –∑–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ...
    </div>
    
    <div>
        <button onclick="testProduction()">–¢–µ—Å—Ç Production API</button>
        <button onclick="openProduction()">–û—Ç–≤–æ—Ä–∏ Production —Å–∞–π—Ç–∞</button>
    </div>
    
    <div id="results" class="results" style="display:none;">
        <h3>–†–µ–∑—É–ª—Ç–∞—Ç–∏:</h3>
        <pre id="resultsText"></pre>
    </div>

    <script>
        // –û–ø–∏—Ç–≤–∞–º–µ —Ä–∞–∑–ª–∏—á–Ω–∏ –≤—ä–∑–º–æ–∂–Ω–∏ URL-–∏
        const possibleUrls = [
            'https://veganmapai-bkozarev.replit.app',
            'https://veganmapai.replit.app',
            'https://veganmapai-bkozarev.repl.co',
            'https://veganmapai.repl.co'
        ];
        
        async function testProduction() {
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            const resultsTextEl = document.getElementById('resultsText');
            
            statusEl.className = 'status loading';
            statusEl.textContent = '–¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ production API...';
            resultsEl.style.display = 'none';
            
            let workingUrl = null;
            let results = [];
            
            for (const url of possibleUrls) {
                try {
                    const response = await fetch(`${url}/api/restaurants/public/map-data`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        },
                        mode: 'cors'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const restaurantCount = data.restaurants ? data.restaurants.length : 0;
                        
                        results.push(`‚úÖ ${url} - –†–ê–ë–û–¢–ò! –ù–∞–º–µ—Ä–µ–Ω–∏ ${restaurantCount} —Ä–µ—Å—Ç–æ—Ä–∞–Ω—Ç–∞`);
                        
                        if (restaurantCount > 0 && !workingUrl) {
                            workingUrl = url;
                            statusEl.className = 'status success';
                            statusEl.innerHTML = `
                                <strong>üéâ –£–°–ü–ï–•!</strong><br>
                                Production —Ä–∞–±–æ—Ç–∏ –Ω–∞: <a href="${url}" target="_blank">${url}</a><br>
                                –ù–∞–º–µ—Ä–µ–Ω–∏ —Å–∞ ${restaurantCount} —Ä–µ—Å—Ç–æ—Ä–∞–Ω—Ç–∞!
                            `;
                        }
                    } else {
                        results.push(`‚ùå ${url} - HTTP ${response.status}`);
                    }
                } catch (error) {
                    results.push(`‚ùå ${url} - ${error.message}`);
                }
            }
            
            if (!workingUrl) {
                statusEl.className = 'status error';
                statusEl.innerHTML = `
                    <strong>‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!</strong><br>
                    Production API –≤—Å–µ –æ—â–µ –Ω–µ –æ—Ç–≥–æ–≤–∞—Ä—è.<br>
                    –ú–æ–ª—è, –∏–∑—á–∞–∫–∞–π—Ç–µ 1-2 –º–∏–Ω—É—Ç–∏ —Å–ª–µ–¥ Redeploy –∏ –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.
                `;
            }
            
            resultsEl.style.display = 'block';
            resultsTextEl.textContent = results.join('\n');
        }
        
        function openProduction() {
            // –û–ø–∏—Ç–≤–∞–º–µ –¥–∞ –æ—Ç–≤–æ—Ä–∏–º –ø—ä—Ä–≤–∏—è URL
            window.open(possibleUrls[0], '_blank');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        setTimeout(() => {
            console.log('Ready for testing. Click the button to test production.');
        }, 1000);
    </script>
</body>
</html>